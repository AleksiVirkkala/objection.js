<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Relations | Objection.js</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="An SQL friendly ORM for node.js">
    <link rel="preload" href="/objection.js/assets/css/0.styles.0f46ca33.css" as="style"><link rel="preload" href="/objection.js/assets/js/app.8dd7d762.js" as="script"><link rel="preload" href="/objection.js/assets/js/6.7d5e48c0.js" as="script"><link rel="preload" href="/objection.js/assets/js/7.0f19e18f.js" as="script"><link rel="preload" href="/objection.js/assets/js/31.fb10771f.js" as="script"><link rel="prefetch" href="/objection.js/assets/js/1.badd168a.js"><link rel="prefetch" href="/objection.js/assets/js/10.e61524f2.js"><link rel="prefetch" href="/objection.js/assets/js/11.4052b195.js"><link rel="prefetch" href="/objection.js/assets/js/12.6f6ccbb5.js"><link rel="prefetch" href="/objection.js/assets/js/13.03f26a8c.js"><link rel="prefetch" href="/objection.js/assets/js/14.e876ffb7.js"><link rel="prefetch" href="/objection.js/assets/js/15.88b4f06c.js"><link rel="prefetch" href="/objection.js/assets/js/16.d7625109.js"><link rel="prefetch" href="/objection.js/assets/js/17.dc2ae831.js"><link rel="prefetch" href="/objection.js/assets/js/18.c859dfdf.js"><link rel="prefetch" href="/objection.js/assets/js/19.b1eebbb1.js"><link rel="prefetch" href="/objection.js/assets/js/2.0054fdf2.js"><link rel="prefetch" href="/objection.js/assets/js/20.866c1b0f.js"><link rel="prefetch" href="/objection.js/assets/js/21.a505508e.js"><link rel="prefetch" href="/objection.js/assets/js/22.79c8a052.js"><link rel="prefetch" href="/objection.js/assets/js/23.93cf0e92.js"><link rel="prefetch" href="/objection.js/assets/js/24.f8adb0ce.js"><link rel="prefetch" href="/objection.js/assets/js/25.1c203468.js"><link rel="prefetch" href="/objection.js/assets/js/26.c741e666.js"><link rel="prefetch" href="/objection.js/assets/js/27.54f6c9fc.js"><link rel="prefetch" href="/objection.js/assets/js/28.89492b12.js"><link rel="prefetch" href="/objection.js/assets/js/29.a959d614.js"><link rel="prefetch" href="/objection.js/assets/js/3.b3ce0911.js"><link rel="prefetch" href="/objection.js/assets/js/30.4433048c.js"><link rel="prefetch" href="/objection.js/assets/js/32.dff1f06a.js"><link rel="prefetch" href="/objection.js/assets/js/33.0a4b2662.js"><link rel="prefetch" href="/objection.js/assets/js/34.321d9867.js"><link rel="prefetch" href="/objection.js/assets/js/35.55b562f7.js"><link rel="prefetch" href="/objection.js/assets/js/36.06f7c627.js"><link rel="prefetch" href="/objection.js/assets/js/37.f090f8fc.js"><link rel="prefetch" href="/objection.js/assets/js/38.ab9a0cfe.js"><link rel="prefetch" href="/objection.js/assets/js/39.f3633191.js"><link rel="prefetch" href="/objection.js/assets/js/40.67b55ad8.js"><link rel="prefetch" href="/objection.js/assets/js/41.77758b3a.js"><link rel="prefetch" href="/objection.js/assets/js/42.0de28e20.js"><link rel="prefetch" href="/objection.js/assets/js/43.3e5cc82b.js"><link rel="prefetch" href="/objection.js/assets/js/44.f86e3c7c.js"><link rel="prefetch" href="/objection.js/assets/js/45.a824fc9b.js"><link rel="prefetch" href="/objection.js/assets/js/46.8c7551d2.js"><link rel="prefetch" href="/objection.js/assets/js/47.fddda9b6.js"><link rel="prefetch" href="/objection.js/assets/js/48.4c8bd88f.js"><link rel="prefetch" href="/objection.js/assets/js/49.075c5305.js"><link rel="prefetch" href="/objection.js/assets/js/50.c70a0ac5.js"><link rel="prefetch" href="/objection.js/assets/js/51.d30027a1.js"><link rel="prefetch" href="/objection.js/assets/js/52.7bf885a4.js"><link rel="prefetch" href="/objection.js/assets/js/53.fe4ad436.js"><link rel="prefetch" href="/objection.js/assets/js/54.d1396a31.js"><link rel="prefetch" href="/objection.js/assets/js/55.a8c3d29a.js"><link rel="prefetch" href="/objection.js/assets/js/56.ce15257f.js"><link rel="prefetch" href="/objection.js/assets/js/57.79f9cfdf.js"><link rel="prefetch" href="/objection.js/assets/js/8.d3fea037.js"><link rel="prefetch" href="/objection.js/assets/js/9.a610c6c3.js"><link rel="prefetch" href="/objection.js/assets/js/vendors~docsearch.d2b1c980.js">
    <link rel="stylesheet" href="/objection.js/assets/css/0.styles.0f46ca33.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/objection.js/" class="home-link router-link-active"><!----> <span class="site-name">Objection.js</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/objection.js/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API Reference" class="dropdown-title"><span class="title">API Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/api/objection/" class="nav-link">
  Main Module
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/query-builder/" class="nav-link">
  Query Builder
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/model/" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/types/" class="nav-link">
  Types
</a></li></ul></div></div><div class="nav-item"><a href="/objection.js/recipes/" class="nav-link">
  Recipe Book
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Release Notes" class="dropdown-title"><span class="title">Release Notes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/release-notes/changelog.html" class="nav-link">
  Changelog
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/release-notes/migration.html" class="nav-link">
  Migration to 2.0
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Vincit/objection.js/tree/v1/doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ‚≠ê Star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/objection.js/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="API Reference" class="dropdown-title"><span class="title">API Reference</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/api/objection/" class="nav-link">
  Main Module
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/query-builder/" class="nav-link">
  Query Builder
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/model/" class="nav-link">
  Model
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/api/types/" class="nav-link">
  Types
</a></li></ul></div></div><div class="nav-item"><a href="/objection.js/recipes/" class="nav-link">
  Recipe Book
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Release Notes" class="dropdown-title"><span class="title">Release Notes</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/objection.js/release-notes/changelog.html" class="nav-link">
  Changelog
</a></li><li class="dropdown-item"><!----> <a href="/objection.js/release-notes/migration.html" class="nav-link">
  Migration to 2.0
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/Vincit/objection.js/tree/v1/doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  v1.x documentation
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ‚≠ê Star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/vincit/objection.js" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/objection.js/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/objection.js/guide/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/objection.js/guide/models.html" class="sidebar-link">Models</a></li><li><a href="/objection.js/guide/relations.html" class="active sidebar-link">Relations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/objection.js/guide/relations.html#examples" class="sidebar-link">Examples</a></li><li class="sidebar-sub-header"><a href="/objection.js/guide/relations.html#require-loops" class="sidebar-link">Require loops</a></li></ul></li><li><a href="/objection.js/guide/query-examples.html" class="sidebar-link">Query examples</a></li><li><a href="/objection.js/guide/transactions.html" class="sidebar-link">Transactions</a></li><li><a href="/objection.js/guide/hooks.html" class="sidebar-link">Hooks</a></li><li><a href="/objection.js/guide/validation.html" class="sidebar-link">Validation</a></li><li><a href="/objection.js/guide/documents.html" class="sidebar-link">Documents</a></li><li><a href="/objection.js/guide/plugins.html" class="sidebar-link">Plugins</a></li><li><a href="/objection.js/guide/contributing.html" class="sidebar-link">Contribution guide</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="relations"><a href="#relations" class="header-anchor">#</a> Relations</h1> <p>We already went through how to create relationships (aka. relations, associations) in the <a href="/objection.js/guide/models.html">models</a> section's examples but here's a list of all the available relation types in a nicely searchable place. See <a href="/objection.js/api/types/#type-relationmapping">this</a> API doc section for full documentation of the relation mapping parameters.</p> <p>Relationships are a very basic concept in relational databases and if you aren't familiar with it, you should spend some time googling it first. Basically there are three ways to create a relationship between two tables <code>A</code> and <code>B</code>:</p> <ol><li><p>Table <code>A</code> has a column that holds table <code>B</code>'s id. This relationship is called a <code>BelongsToOneRelation</code> in objection.
We can say that <code>A</code> belongs to one <code>B</code>.</p></li> <li><p>Table <code>B</code> has a column that holds table <code>A</code>'s id. This relationship is called a <code>HasManyRelation</code> in objection.
We can say that <code>A</code> has many <code>B</code>'s.</p></li> <li><p>Table <code>C</code> has columns for both <code>A</code> and <code>B</code> tables' identifiers. This relationship is called <code>ManyToManyRelation</code> in objection.
Each row in <code>C</code> joins one <code>A</code> with one <code>B</code>. Therefore an <code>A</code> row can be related to multiple <code>B</code> rows and a <code>B</code> row can be related to
multiple <code>A</code> rows through table <code>C</code>.</p></li></ol> <p>While relations are usually created between the primary key of one table and a foreign key reference of another table, objection has no such limitations. You can create relationship using any two columns (or any sets of columns). You can even create relation using values nested deep inside json columns.</p> <p>If you've used other ORMs you may notice that objection's <a href="/objection.js/api/model/static-properties.html#static-relationmappings">relationMappings</a> are pretty verbose. There are couple of reasons for that:</p> <ol><li><p>For a new user, this style underlines what is happening, and which columns and tables are involved.</p></li> <li><p>You only need to define relations once. Writing a couple of lines more for clarity shouldn't impact your productivity.</p></li></ol> <h2 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h2> <p>Vocabulary for the relation descriptions:</p> <ul><li>source model: The model for which you are writing the <code>relationMapping</code> for.</li> <li>related model: The model at the other end of the relation.</li></ul> <p><code>BelongsToOneRelation</code>: Use this relation when the source model has the foreign key</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> tableName <span class="token operator">=</span> <span class="token string">'animals'</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> relationMappings <span class="token operator">=</span> <span class="token punctuation">{</span>
    owner<span class="token operator">:</span> <span class="token punctuation">{</span>
      relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>BelongsToOneRelation<span class="token punctuation">,</span>
      modelClass<span class="token operator">:</span> Person<span class="token punctuation">,</span>
      join<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'animals.ownerId'</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'persons.id'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HasManyRelation</code>: Use this relation when the related model has the foreign key</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> tableName <span class="token operator">=</span> <span class="token string">'persons'</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> relationMappings <span class="token operator">=</span> <span class="token punctuation">{</span>
    animals<span class="token operator">:</span> <span class="token punctuation">{</span>
      relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>HasManyRelation<span class="token punctuation">,</span>
      modelClass<span class="token operator">:</span> Animal<span class="token punctuation">,</span>
      join<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'animals.ownerId'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HasOneRelation</code>: Just like <code>HasManyRelation</code> but for one related row</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> tableName <span class="token operator">=</span> <span class="token string">'persons'</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> relationMappings <span class="token operator">=</span> <span class="token punctuation">{</span>
    animal<span class="token operator">:</span> <span class="token punctuation">{</span>
      relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>HasOneRelation<span class="token punctuation">,</span>
      modelClass<span class="token operator">:</span> Animal<span class="token punctuation">,</span>
      join<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'animals.ownerId'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>ManyToManyRelation</code>: Use this relation when the model is related to a list of other models through a join table</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> tableName <span class="token operator">=</span> <span class="token string">'persons'</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> relationMappings <span class="token operator">=</span> <span class="token punctuation">{</span>
    movies<span class="token operator">:</span> <span class="token punctuation">{</span>
      relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>ManyToManyRelation<span class="token punctuation">,</span>
      modelClass<span class="token operator">:</span> Movie<span class="token punctuation">,</span>
      join<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// persons_movies is the join table.</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons_movies.personId'</span><span class="token punctuation">,</span>
          to<span class="token operator">:</span> <span class="token string">'persons_movies.movieId'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'movies.id'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HasOneThroughRelation</code>: Use this relation when the model is related to a single model through a join table</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> tableName <span class="token operator">=</span> <span class="token string">'persons'</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> relationMappings <span class="token operator">=</span> <span class="token punctuation">{</span>
    movie<span class="token operator">:</span> <span class="token punctuation">{</span>
      relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>HasOneThroughRelation<span class="token punctuation">,</span>
      modelClass<span class="token operator">:</span> Movie<span class="token punctuation">,</span>
      join<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
        through<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// persons_movies is the join table.</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons_movies.personId'</span><span class="token punctuation">,</span>
          to<span class="token operator">:</span> <span class="token string">'persons_movies.movieId'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'movies.id'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="require-loops"><a href="#require-loops" class="header-anchor">#</a> Require loops</h2> <p>Require loops (circular dependencies, circular requires) are a very common problem when defining relations. Whenever a module <code>A</code> imports module <code>B</code> that immediately (synchronously) imports module <code>A</code>, you create a require loop that node.js or objection cannot solve automatically. A require loop usually leads to the other imported value to be an empty object which causes all kinds of problems. Objection attempts to detect these situations and mention the words <code>require loop</code> in the thrown error. Objection offers multiple solutions to this problem. See the circular dependency solutions examples in this section. In addition to objection's solutions, you can always organize your code so that such loops are not created.</p> <p>Solutions to require loops</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">tableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'persons'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">relationMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Solution 1:</span>
    <span class="token comment">//</span>
    <span class="token comment">// relationMappings getter is accessed lazily when you execute</span>
    <span class="token comment">// your first query that needs it. Therefore if you `require`</span>
    <span class="token comment">// your models inside the getter, you don't end up with a require loop.</span>
    <span class="token comment">// Note that only one end of the relation needs to be required like</span>
    <span class="token comment">// this, not both. `relationMappings` can also be a method or</span>
    <span class="token comment">// a thunk if you prefer those instead of getters.</span>
    <span class="token keyword">const</span> Animal <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./Animal'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      pets<span class="token operator">:</span> <span class="token punctuation">{</span>
        relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>HasManyRelation<span class="token punctuation">,</span>
        modelClass<span class="token operator">:</span> Animal<span class="token punctuation">,</span>
        join<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
          to<span class="token operator">:</span> <span class="token string">'animals.ownerId'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      movies<span class="token operator">:</span> <span class="token punctuation">{</span>
        relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>ManyToManyRelation<span class="token punctuation">,</span>
        <span class="token comment">// Solution 2:</span>
        <span class="token comment">//</span>
        <span class="token comment">// Absolute file path to a module that exports the model class.</span>
        <span class="token comment">// This is similar to solution 1, but objection calls `require`</span>
        <span class="token comment">// under the hood. The downside here is that you need to give</span>
        <span class="token comment">// an absolute file path because of the way `require` works.</span>
        modelClass<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'Movie'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        join<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
          through<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// persons_movies is the join table.</span>
            <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons_movies.personId'</span><span class="token punctuation">,</span>
            to<span class="token operator">:</span> <span class="token string">'persons_movies.movieId'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          to<span class="token operator">:</span> <span class="token string">'movies.id'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      movies<span class="token operator">:</span> <span class="token punctuation">{</span>
        relation<span class="token operator">:</span> Model<span class="token punctuation">.</span>ManyToManyRelation<span class="token punctuation">,</span>
        <span class="token comment">// Solution 3:</span>
        <span class="token comment">//</span>
        <span class="token comment">// Use only a module name and define a `modelPaths` property</span>
        <span class="token comment">// for your model (or a superclass of your model). Search for</span>
        <span class="token comment">// `modelPaths` from the docs for more info.</span>
        modelClass<span class="token operator">:</span> <span class="token string">'Movie'</span><span class="token punctuation">,</span>
        join<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons.id'</span><span class="token punctuation">,</span>
          through<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">'persons_movies.personId'</span><span class="token punctuation">,</span>
            to<span class="token operator">:</span> <span class="token string">'persons_movies.movieId'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          to<span class="token operator">:</span> <span class="token string">'movies.id'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/objection.js/guide/models.html" class="prev">
        Models
      </a></span> <span class="next"><a href="/objection.js/guide/query-examples.html">
        Query examples
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/objection.js/assets/js/app.8dd7d762.js" defer></script><script src="/objection.js/assets/js/6.7d5e48c0.js" defer></script><script src="/objection.js/assets/js/7.0f19e18f.js" defer></script><script src="/objection.js/assets/js/31.fb10771f.js" defer></script>
  </body>
</html>
