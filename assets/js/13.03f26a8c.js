(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{366:function(e,t,o){"use strict";o.r(t);var a=o(43),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"overview"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),o("h2",{attrs:{id:"model-data-lifecycle"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#model-data-lifecycle"}},[e._v("#")]),e._v(" Model data lifecycle")]),e._v(" "),o("p",[e._v("For the purposes of this explanation, let’s define three data layouts:")]),e._v(" "),o("ol",[o("li",[o("code",[e._v("database")]),e._v(": The data layout returned by the database.")]),e._v(" "),o("li",[o("code",[e._v("internal")]),e._v(": The data layout of a model instance.")]),e._v(" "),o("li",[o("code",[e._v("external")]),e._v(": The data layout after calling model.toJSON().")])]),e._v(" "),o("p",[e._v("Whenever data is converted from one layout to another, converter methods are called:")]),e._v(" "),o("ol",[o("li",[o("code",[e._v("database")]),e._v(" -> "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#parsedatabasejson"}},[e._v("$parseDatabaseJson")]),e._v(" -> "),o("code",[e._v("internal")])],1),e._v(" "),o("li",[o("code",[e._v("internal")]),e._v(" -> "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#formatdatabasejson"}},[e._v("$formatDatabaseJson")]),e._v(" -> "),o("code",[e._v("database")])],1),e._v(" "),o("li",[o("code",[e._v("external")]),e._v(" -> "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#parsejson"}},[e._v("$parseJson")]),e._v(" -> "),o("code",[e._v("internal")])],1),e._v(" "),o("li",[o("code",[e._v("internal")]),e._v(" -> "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#formatjson"}},[e._v("$formatJson")]),e._v(" -> "),o("code",[e._v("external")])],1)]),e._v(" "),o("p",[e._v("So for example when the results of a query are read from the database the data goes through the "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#parsedatabasejson"}},[e._v("$parseDatabaseJson")]),e._v(" method. When data is written to database it goes through the "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#formatdatabasejson"}},[e._v("$formatDatabaseJson")]),e._v(" method.")],1),e._v(" "),o("p",[e._v("Similarly when you give data for a query (for example "),o("RouterLink",{attrs:{to:"/api/query-builder/mutate-methods.html#insert"}},[o("code",[e._v("query().insert(req.body)")])]),e._v(") or create a model explicitly using "),o("RouterLink",{attrs:{to:"/api/model/static-methods.html#static-fromjson"}},[o("code",[e._v("Model.fromJson(obj)")])]),e._v(" the "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#parsejson"}},[e._v("$parseJson")]),e._v(" method is invoked. When you call "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#tojson"}},[o("code",[e._v("model.toJSON()")])]),e._v(" or "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#tojson"}},[o("code",[e._v("model.$toJson()")])]),e._v(" the "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#formatjson"}},[e._v("$formatJson")]),e._v(" is called.")],1),e._v(" "),o("p",[e._v("Note: Most libraries like "),o("a",{attrs:{href:"http://expressjs.com/en/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("express"),o("OutboundLink")],1),e._v(" and "),o("a",{attrs:{href:"https://koajs.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("koa"),o("OutboundLink")],1),e._v(" automatically call the "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#tojson"}},[e._v("toJSON")]),e._v(" method when you pass the model instance to methods like "),o("code",[e._v("response.json(model)")]),e._v(". You rarely need to call "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#tojson"}},[e._v("toJSON()")]),e._v(" or "),o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#tojson"}},[e._v("$toJson()")]),e._v(" explicitly.")],1),e._v(" "),o("p",[e._v("By overriding the lifecycle methods, you can have different layouts for the data in database and when exposed to the outside world.")]),e._v(" "),o("p",[e._v("All instance methods of models are prefixed with "),o("code",[e._v("$")]),e._v(" letter so that they won’t overlap with database properties. All properties that start with "),o("code",[e._v("$")]),e._v(" are also removed from "),o("code",[e._v("database")]),e._v(" and "),o("code",[e._v("external")]),e._v(" layouts.")]),e._v(" "),o("p",[e._v("In addition to these data formatting hooks, Model also has query lifecycle hooks")]),e._v(" "),o("ul",[o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#beforeupdate"}},[e._v("$beforeUpdate")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#afterupdate"}},[e._v("$afterUpdate")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#beforeinsert"}},[e._v("$beforeInsert")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#afterinsert"}},[e._v("$afterInsert")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#beforedelete"}},[e._v("$beforeDelete")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#afterdelete"}},[e._v("$afterDelete")])],1),e._v(" "),o("li",[o("RouterLink",{attrs:{to:"/api/model/instance-methods.html#afterfind"}},[e._v("$afterFind")])],1)])])}),[],!1,null,null,null);t.default=s.exports}}]);